description: "Workflow for KUL_LES data"

# --- Define all file paths explicitly ---
# This completely replaces the need for meta.yaml
# Paths are relative to this config file's location.
paths:
  system_config: data/KUL_LES/wind_energy_system/system_pywake.yaml
  reference_power: data/KUL_LES/observed_output/observedPowerKUL.nc
  reference_resource: data/KUL_LES/plant_energy_resource/originalData.nc
  wind_farm_layout: data/KUL_LES/plant_wind_farm/FLOW_UQ_vnv_toy_study_wind_farm.yaml

  # --- Define output locations ---
  output_dir: data/KUL_LES/wifa_uq_results # All results will be saved here
  processed_resource_file: "processed_physical_inputs.nc" # Will be saved in output_dir
  database_file: "results_stacked_hh.nc"         # Will be saved in output_dir

# --- Preprocessing now operates on the files above ---
preprocessing:
  run: true
  steps: [recalculate_params]

# --- DB Gen now just defines parameters ---
database_gen:
  run: true
  flow_model: pywake
  param_config:
    attributes.analysis.wind_deficit_model.wake_expansion_coefficient.k_b:
      range: [0.01, 0.07]
      default: 0.04           # ← Default value for baseline comparison
      short_name: "k_b"       # ← Name used in database coordinates
    attributes.analysis.blockage_model.ss_alpha:
      range: [0.75, 1.0]
      default: 0.875
      short_name: "ss_alpha"
  n_samples: 100

# --- Error Prediction ---
error_prediction:
  run: true
  features:
    - ABL_height
    - wind_veer
    - lapse_rate
  model: "PCE"
  model_params:
    degree: 5                  # PCE polynomial degree
    marginals: "kernel"        # "kernel", "uniform", "normal"
    copula: "independent"      # "independent" or "normal"
    q: 0.5                     # hyperbolic truncation parameter
    max_features: 5            # safety limit
    allow_high_dim: false      # refuse > 5 inputs unless set true
  calibrator: LocalParameterPredictor
  bias_predictor: BiasPredictor
  cross_validation:
    run: true
    splitting_mode: kfold_shuffled
    n_splits: 6
    metrics:
    - rmse
    - r2

sensitivity_analysis:
  # General call for sensitivity. Will run SHAP for "XGB"
  # or plot "directions_" for "SIRPolynomial".
  run_observation_sensitivity: true
  run_bias_sensitivity: true
