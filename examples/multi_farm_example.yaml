# Multi-Farm Database Generation for EDF Datasets
#
# Each farm requires:
#   - name: Unique identifier (used for grouping in cross-validation)
#   - system_config: Path to wind energy system YAML (windIO format)

paths:
  output_dir: results/multi_farm/
  database_file: combined_database.nc

# All EDF wind farm datasets
farms:
  # Horns Rev farms
  - name: HR1
    system_config: data/EDF_datasets/HR1/wind_energy_system.yaml
  - name: HR2
    system_config: data/EDF_datasets/HR2/wind_energy_system.yaml
  - name: HR3
    system_config: data/EDF_datasets/HR3/wind_energy_system.yaml

  # Nysted farms
  - name: NYSTED1
    system_config: data/EDF_datasets/NYSTED1/wind_energy_system.yaml
  - name: NYSTED2
    system_config: data/EDF_datasets/NYSTED2/wind_energy_system.yaml

  # Virtual wind farms - IEA turbines
  - name: VirtWF_ABL_IEA10
    system_config: data/EDF_datasets/VirtWF_ABL_IEA10/wind_energy_system.yaml
  - name: VirtWF_ABL_IEA22
    system_config: data/EDF_datasets/VirtWF_ABL_IEA22/wind_energy_system.yaml

  # Virtual wind farms - IEA15 with different layouts
  - name: VirtWF_ABL_IEA15_ali_DX5_DY5
    system_config: data/EDF_datasets/VirtWF_ABL_IEA15_ali_DX5_DY5/wind_energy_system.yaml
  - name: VirtWF_ABL_IEA15_stag_DX5_DY5
    system_config: data/EDF_datasets/VirtWF_ABL_IEA15_stag_DX5_DY5/system_staggered_DX5D_DY5D_Turbine_Number100.yaml
  - name: VirtWF_ABL_IEA15_stag_DX5_DY7p5
    system_config: data/EDF_datasets/VirtWF_ABL_IEA15_stag_DX5_DY7p5/system_staggered_DX5D_DY7.5D_Turbine_Number100.yaml
  - name: VirtWF_ABL_IEA15_stag_DX7p5_DY5
    system_config: data/EDF_datasets/VirtWF_ABL_IEA15_stag_DX7p5_DY5/system_staggered_DX7.5D_DY5D_Turbine_Number100.yaml

preprocessing:
  run: true
  steps:
    - recalculate_params

# Database generation settings (shared across all farms)
database_gen:
  run: true
  flow_model: pywake
  n_samples: 100
  param_config:
    attributes.analysis.wind_deficit_model.wake_expansion_coefficient.k_b:
      range: [0.01, 0.07]
      default: 0.04
      short_name: "k_b"
    attributes.analysis.blockage_model.ss_alpha:
      range: [0.75, 1.0]
      default: 0.875
      short_name: "ss_alpha"

# Error prediction with LeaveOneGroupOut cross-validation
error_prediction:
  run: true
  features:
    - ABL_height
    - wind_veer
    - lapse_rate
    - Blockage_Ratio
    - Blocking_Distance

  model: "XGB"
  calibrator: MinBiasCalibrator
  bias_predictor: BiasPredictor

  cross_validation:
    run: true
    splitting_mode: LeaveOneGroupOut
    # Groups for LOGO CV - farms grouped by type/location
    # Names here must match the 'name' field in farms list above
    groups:
      HornsRev:
        - HR1
        - HR2
        - HR3
      Nysted:
        - NYSTED1
        - NYSTED2
      VirtIEA10:
        - VirtWF_ABL_IEA10
      VirtIEA22:
        - VirtWF_ABL_IEA22
      VirtIEA15_aligned:
        - VirtWF_ABL_IEA15_ali_DX5_DY5
      VirtIEA15_staggered:
        - VirtWF_ABL_IEA15_stag_DX5_DY5
        - VirtWF_ABL_IEA15_stag_DX5_DY7p5
        - VirtWF_ABL_IEA15_stag_DX7p5_DY5

sensitivity_analysis:
  run_observation_sensitivity: true
  run_bias_sensitivity: true
